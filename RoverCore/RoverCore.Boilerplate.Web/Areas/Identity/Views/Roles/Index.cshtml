@model IEnumerable<RoverCore.Boilerplate.Domain.Entities.Identity.ApplicationRole>

@{
        ViewData["Title"] = "Manage Roles";
        var routeData = ViewContext.RouteData.Values;
        var viewController = routeData["controller"].ToString();
        var viewArea = routeData.ContainsKey("area") ? routeData["area"].ToString() : "";
        
        var recordsUrl = Url.Action("GetRoles");
        
}

<div class="page-header d-print-none mb-2">
	<div class="row align-items-center">
		<div class="col">
			<div class="page-pretitle">
				@ViewData["AreaTitle"]
			</div>
			<h2 class="page-title">
				Manage Roles
			</h2>
		</div>
		<div class="col-auto ms-auto d-print-none">
			<div class="btn-list">
			  
				<a asp-action="Create" class="btn btn-primary d-none d-sm-inline-block">
					<svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
					Create new Role
				</a>
			
			</div>
		</div>
	</div>
</div>
<div class="card shadow">	
	<div class="card-body table-responsive" id="Index_container">	
		<table class="table" id="Index">
			<thead>
			<tr>
				<th>
					@Html.DisplayNameFor(model => model.Id)
				</th>
				<th>
					@Html.DisplayNameFor(model => model.Name)
				</th>
				<th>
					@Html.DisplayNameFor(model => model.NormalizedName)
				</th>
				<th>
					@Html.DisplayNameFor(model => model.ConcurrencyStamp)
				</th>
				<th>Actions</th>
			</tr>
			</thead>
		</table>
	</div>	
</div>
<div class="modal modal-blur fade show" id="modal-dialog" tabindex="-1" style="display: none;" aria-modal="true" role="dialog">
	<div class="modal-dialog modal-xl modal-dialog-centered" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Are you sure you want to delete this record?</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body" id="modal-dialog-content"></div>			
			<div class="modal-footer">
				<button type="button" class="btn me-auto" data-bs-dismiss="modal">Go Back</button>
				<button type="button" class="btn btn-danger delete-confirm" data-bs-dismiss="modal">Delete</button>
			</div>

		</div>
	</div>
</div>

@using (Html.BeginForm(null, null, FormMethod.Post, new { id = "__AjaxAntiForgeryForm" }))
{
	@Html.AntiForgeryToken();
}
@section Styles {	
    <link rel="stylesheet" type="text/css" href="~/vendor/datatables.net-bs5/dataTables.bootstrap5.min.css" />
    <link rel="stylesheet" type="text/css" href="~/vendor/datatables.net-responsive-bs5/responsive.bootstrap5.min.css">
}	

@section Scripts {	
	
	<script src="~/vendor/pdfmake/pdfmake.min.js"></script>
	<script src="~/vendor/pdfmake/vfs_fonts.min.js"></script>
	<script src="~/vendor/datatables.net/jquery.dataTables.min.js"></script>
	<script src="~/vendor/datatables.net-bs5/dataTables.bootstrap5.min.js"></script>
    <script src="~/vendor/datatables.net-responsive-bs5/responsive.bootstrap5.min.js"></script>
    <script type="text/javascript">	
	
	$(document).ready(function () {	
			
			$('[data-toggle="tooltip"]').tooltip();	
			
			var form = $('#__AjaxAntiForgeryForm');
			var token = $('input[name="__RequestVerificationToken"]', form).val();
			
            var table = $('#Index').DataTable(
                {
                    "processing": true,
                    "serverSide": true,
                    "filter": true,
                    "ajax": {
                        "url": "@Url.Action("GetRoles")",
                        "type": "POST",
						"data": {"__RequestVerificationToken" : token},
						"datatype": "json"
                    },
                    "columnDefs": [
                            {
                                "defaultContent": "-", "targets": "_all"
                            },
                            {
                            "targets": [0],
                            "visible": false,
                            "searchable": false
                        }],
                    "columns": [
					    { "data": "Id", "name": "Id", "autoWidth": true },
						{ "data": "name", "name": "Name", "autoWidth": true },
						{ "data": "normalizedName", "name": "NormalizedName", "autoWidth": true },
						{ "data": "concurrencyStamp", "name": "ConcurrencyStamp", "autoWidth": true },
                        {
                            "render": function(data, type, row) {
                                var controls = "<a href='@(Url.Action("Edit"))/" + row.id + "' class='btn btn-primary me-1'><i class='icon las la-wrench'></i> Edit</a>" +
                                    "<a href='@(Url.Action("Details"))/" + row.id + "' class='btn btn-primary me-1'><i class='icon las la-info-circle'></i> Details</a>" +
                                    "<button data-href='@(Url.Action("Delete"))/" + row.id + "' class='btn btn-danger delete-button me-1'><i class='icon las la-trash'></i> Delete</a>";
								    
                                return controls;
                            }
                        }
					],
					pageLength: 10,
					responsive: true,
					order: [[2, "asc"]],
					"language": {
						"emptyTable": "No records found."
                }
			});

			table.columns.adjust().draw();	

			$(document).on('click', '.delete-button', function(){ 
				var $btn = $(this);
				var url = $btn.data("href");
				$('#modal-dialog-content').load(url);
				$('#modal-dialog').modal('show');
			});

			$(document).on('click', '.delete-confirm', function() {
				$('#deleteForm').submit();
			});
        });	
    </script>	

}
